# 什么是内部类

内部类是定义在另一个类内部的类。内部类可以访问外部类的所有成员，包括私有成员，而外部类也可以访问内部类的所有成员。

# 内部类的类型

Java 中有四种类型的内部类：

1. **成员内部类**：定义在类内部，方法外部的类
2. **局部内部类**：定义在方法内部的类
3. **匿名内部类**：没有名称的内部类，通常用于创建接口或抽象类的实例
4. **静态内部类**：使用 static 关键字修饰的内部类

# 成员内部类

成员内部类是定义在类内部，方法外部的类。

## 语法

```java
public class OuterClass {
    // 外部类成员

    // 成员内部类
    class InnerClass {
        // 内部类成员
    }
}
```

## 特点

- 成员内部类可以访问外部类的所有成员，包括私有成员
- 成员内部类不能包含静态成员（静态常量除外）
- 创建成员内部类的实例需要先创建外部类的实例

## 示例

```java
public class OuterClass {
    private int outerVar = 10;

    class InnerClass {
        private int innerVar = 20;

        public void display() {
            System.out.println("Outer variable: " + outerVar);
            System.out.println("Inner variable: " + innerVar);
        }
    }

    public static void main(String[] args) {
        // 创建外部类实例
        OuterClass outer = new OuterClass();
        // 创建内部类实例
        OuterClass.InnerClass inner = outer.new InnerClass();
        // 调用内部类方法
        inner.display();
    }
}
```

# 局部内部类

局部内部类是定义在方法内部的类。

## 语法

```java
public class OuterClass {
    public void method() {
        // 局部内部类
        class LocalInnerClass {
            // 内部类成员
        }
    }
}
```

## 特点

- 局部内部类只能在定义它的方法内部使用
- 局部内部类可以访问外部类的所有成员
- 局部内部类可以访问方法中的局部变量，但这些变量必须是 final 或 effectively final

## 示例

```java
public class OuterClass {
    private int outerVar = 10;

    public void method() {
        final int localVar = 30;

        // 局部内部类
        class LocalInnerClass {
            public void display() {
                System.out.println("Outer variable: " + outerVar);
                System.out.println("Local variable: " + localVar);
            }
        }

        // 创建局部内部类实例并调用方法
        LocalInnerClass inner = new LocalInnerClass();
        inner.display();
    }

    public static void main(String[] args) {
        OuterClass outer = new OuterClass();
        outer.method();
    }
}
```

# 匿名内部类

匿名内部类是没有名称的内部类，通常用于创建接口或抽象类的实例。

## 语法

```java
// 实现接口
InterfaceName instance = new InterfaceName() {
    // 实现接口方法
};

// 继承抽象类
AbstractClassName instance = new AbstractClassName() {
    // 实现抽象方法
};
```

## 特点

- 匿名内部类没有名称，只能使用一次
- 匿名内部类必须继承一个类或实现一个接口
- 匿名内部类可以访问外部类的所有成员
- 匿名内部类可以访问方法中的局部变量，但这些变量必须是 final 或 effectively final

## 示例

```java
// 接口
interface Greeting {
    void greet();
}

public class OuterClass {
    private String message = "Hello";

    public void sayHello() {
        // 使用匿名内部类实现Greeting接口
        Greeting greeting = new Greeting() {
            @Override
            public void greet() {
                System.out.println(message + ", Anonymous Inner Class!");
            }
        };

        greeting.greet();
    }

    public static void main(String[] args) {
        OuterClass outer = new OuterClass();
        outer.sayHello();
    }
}
```

# 静态内部类

静态内部类是使用 static 关键字修饰的内部类。

## 语法

```java
public class OuterClass {
    // 外部类成员

    // 静态内部类
    static class StaticInnerClass {
        // 内部类成员
    }
}
```

## 特点

- 静态内部类不能访问外部类的非静态成员
- 静态内部类可以包含静态成员和非静态成员
- 创建静态内部类的实例不需要先创建外部类的实例

## 示例

```java
public class OuterClass {
    private static int staticOuterVar = 10;
    private int nonStaticOuterVar = 20;

    static class StaticInnerClass {
        private int innerVar = 30;
        private static int staticInnerVar = 40;

        public void display() {
            System.out.println("Static outer variable: " + staticOuterVar);
            // 无法访问非静态外部变量
            // System.out.println("Non-static outer variable: " + nonStaticOuterVar); // 编译错误
            System.out.println("Inner variable: " + innerVar);
            System.out.println("Static inner variable: " + staticInnerVar);
        }
    }

    public static void main(String[] args) {
        // 直接创建静态内部类实例，不需要外部类实例
        OuterClass.StaticInnerClass inner = new OuterClass.StaticInnerClass();
        inner.display();
    }
}
```

# 内部类的优点

1. **封装性**：内部类可以隐藏在外部类内部，不被外部代码访问
2. **访问权限**：内部类可以访问外部类的所有成员，包括私有成员
3. **代码组织**：将相关的类组织在一起，提高代码的可读性和维护性
4. **解决多重继承问题**：一个类可以实现多个接口，通过内部类可以间接实现多重继承

# 内部类的应用场景

1. **实现回调**：使用匿名内部类实现事件监听器
2. **实现适配器模式**：使用匿名内部类适配接口
3. **实现迭代器模式**：使用内部类实现迭代器
4. **封装实现细节**：将辅助类作为内部类隐藏起来

# 示例代码

## 内部类的完整示例

```java
// 外部类
public class OuterClass {
    private int outerVar = 10;
    private static int staticOuterVar = 20;

    // 成员内部类
    class MemberInnerClass {
        private int innerVar = 30;

        public void display() {
            System.out.println("Member Inner Class:");
            System.out.println("Outer variable: " + outerVar);
            System.out.println("Static outer variable: " + staticOuterVar);
            System.out.println("Inner variable: " + innerVar);
        }
    }

    // 静态内部类
    static class StaticInnerClass {
        private int innerVar = 40;
        private static int staticInnerVar = 50;

        public void display() {
            System.out.println("\nStatic Inner Class:");
            // 无法访问非静态外部变量
            // System.out.println("Outer variable: " + outerVar); // 编译错误
            System.out.println("Static outer variable: " + staticOuterVar);
            System.out.println("Inner variable: " + innerVar);
            System.out.println("Static inner variable: " + staticInnerVar);
        }
    }

    // 方法
    public void method() {
        final int localVar = 60;

        // 局部内部类
        class LocalInnerClass {
            private int innerVar = 70;

            public void display() {
                System.out.println("\nLocal Inner Class:");
                System.out.println("Outer variable: " + outerVar);
                System.out.println("Static outer variable: " + staticOuterVar);
                System.out.println("Local variable: " + localVar);
                System.out.println("Inner variable: " + innerVar);
            }
        }

        // 创建局部内部类实例
        LocalInnerClass localInner = new LocalInnerClass();
        localInner.display();

        // 匿名内部类
        Runnable runnable = new Runnable() {
            @Override
            public void run() {
                System.out.println("\nAnonymous Inner Class:");
                System.out.println("Outer variable: " + outerVar);
                System.out.println("Static outer variable: " + staticOuterVar);
                System.out.println("Local variable: " + localVar);
            }
        };

        runnable.run();
    }

    public static void main(String[] args) {
        OuterClass outer = new OuterClass();

        // 创建成员内部类实例
        OuterClass.MemberInnerClass memberInner = outer.new MemberInnerClass();
        memberInner.display();

        // 创建静态内部类实例
        OuterClass.StaticInnerClass staticInner = new OuterClass.StaticInnerClass();
        staticInner.display();

        // 调用方法，创建局部内部类和匿名内部类
        outer.method();
    }
}
```

# 总结

内部类是 Java 中一种特殊的类，它定义在另一个类的内部。Java 中有四种类型的内部类：成员内部类、局部内部类、匿名内部类和静态内部类。

内部类的主要优点是：

- 封装性好，可以隐藏实现细节
- 可以访问外部类的所有成员，包括私有成员
- 代码组织更合理，将相关的类放在一起
- 可以间接实现多重继承

内部类在 Java 中有着广泛的应用，特别是在 GUI 编程、事件处理、线程创建等场景中。合理使用内部类可以使代码更加清晰、简洁和灵活。
